<% key = attribute.title  %>
<% row ||= nil %>
<% id = resource[:id]  %>
<% index ||= 'row-template' %>
<% allow_row_removal = (index == 0 ? false : true ) %>
<% field_name_prefix = "#{element_name}[#{index}]" %>

<div id="role-<%= index-%>" class="<%= key.singularize %> single-role multi_linked_custom_metdata" data-index="<%= index-%>">
  <%= hidden_field_tag "#{field_name_prefix}[id]", id %>
  <%= hidden_field_tag "#{field_name_prefix}[custom_metadata_type_id]", attribute.linked_custom_metadata_type.id %>
  <%= hidden_field_tag "#{field_name_prefix}[custom_metadata_attribute_id]", attribute.id %>


  <% attribute.linked_custom_metadata_type.custom_metadata_attributes.each do |attr| %>
<div class="form-group"><label><%= attr.label %></label><%= required_span if attr.required? %>
      <div class="form-group">
        <% attr_element_name = "#{element_name}][#{index}][data][#{attr.title}]" %>
        <%= attribute_form_element(attr, resource, attr_element_name, element_class) %>
        <% unless attribute.description.nil? %>
          <%= custom_metadata_attribute_description(attr.description) %>
        <% end %>
      </div>
</div>
  <% end %>

  <div class="form-group">
    <% if allow_row_removal %>
      <div class="btn-group" data-toggle="buttons">
        <label class="btn btn-danger">
          Remove
          <%= check_box_tag "#{field_name_prefix}[_destroy]", '1', false,
                            class: 'destroy-row', autocomplete: 'off',id:"#{field_name_prefix}-checkbox[_destroy]" %>
        </label>
      </div>
    <% end %>
  </div>

  <% if row %>
    <%= hidden_field_tag("#{field_name_prefix}[id]", id) %>
  <% end %>
</div>
