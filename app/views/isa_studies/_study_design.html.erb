<% study ||= nil %>
<% valid_study = study&.sample_types.present? %>

<% if valid_study %>

	<ul class="nav nav-tabs">
			<li class="active">
					<a data-toggle="tab" data-target="#source_table" onClick="highlightTreeviewItem('source_material')"><em class="glyphicon glyphicon-list-alt"></em> Sources table</a>
			</li>
			<li>
					<a data-toggle="tab" data-target="#study_protocol" onClick="highlightTreeviewItem('sample_collection')"><em class="glyphicon glyphicon-list-alt"></em> Protocol</a>
			</li>
			<li>
					<a data-toggle="tab" data-target="#study_samples_table" onClick="highlightTreeviewItem('study_samples')"><em class="glyphicon glyphicon-list-alt"></em> Samples table</a>
			</li>
			<li>
					<a data-toggle="tab" data-target="#study_experiment_overview" onClick="highlightTreeviewItem('study_table')"><em class="glyphicon glyphicon-list-alt"></em> Experiment overview</a>
			</li>
	</ul>

	<div class="tab-content">
			<div id="source_table" class="tab-pane fade active in">
					<%= render :partial=>"isa_studies/source_material", locals: { study: study} -%>
			</div>
			<div id="study_protocol" class="tab-pane fade">
					<%= render :partial=>"isa_studies/sop", locals: { sop: study ? study.sop : nil} -%>
			</div>
			<div id="study_samples_table" class="tab-pane fade">
					<%= render :partial=>"isa_studies/study_samples", locals: { study: study} -%>
			</div>
			<div id="study_experiment_overview" class="tab-pane fade">
					<%= render :partial=>"isa_studies/study_table", locals: { study: study} -%>   
			</div>
	</div>

	<script>
			function highlightTreeviewItem(item){
					$j(".jstree-clicked").removeClass("jstree-clicked")
					const type = selectedItem.type == "study" ? "study" : selectedItem.parent.type
					const id = selectedItem.type == "study" ? selectedItem.id : selectedItem.parent.id
					const parent = $j(`a[_type="${type}"][_id="${id}"]`)
					$j(parent).next().find(`a[_type="${item}"]`).addClass("jstree-clicked")
					setTimeout(() => updateContainerHeight(), 1000)
			}
	</script>

<% else %>
	<p>
		<em>
			This <%="#{t(:study)}"%>	has not been created in Single Page. 
			Please, create the <%="#{t(:study)}"%> by using the <strong>Design <%="#{t(:study)}"%></strong> button at the <%="#{t(:investigation)}"%> level.
		</em>
	</p>
<% end %>