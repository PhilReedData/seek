<h2><%= @dataset['name'] -%> <small><%= @dataset['type'] -%></small></h2>
<p><%= @dataset['description'] %></p>
<% if @dataset['owner_name'].present? %>
    <strong>Owner:</strong> <%= @dataset['owner_name'] %><br/>
<% end %>
<% if (time = Time.parse(@dataset['creation_date']) rescue nil).present? %>
    <strong>Created:</strong> <%= time %> <span class="subtle">(<%= time_ago_in_words(time) %> ago)</span><br/>
<% end %>
<br/>
<h5>Subtypes</h5>
<ul class="list-group">
  <% @dataset['subtypes'].each do |subtype| %>
      <li class="list-group-item">
        <%= form_tag(register_assay_nels_path(params[:assay_id]), method: :post) do %>
            <%= hidden_field_tag('project_id', params[:project_id]) %>
            <%= hidden_field_tag('dataset_id', params[:dataset_id]) %>
            <%= hidden_field_tag('subtype_name', subtype['type']) %>
            <%= subtype['type'] %> <span class="subtle">(<%= number_to_human_size(subtype['size']) %>)</span>
            <%= button_link_to('Add metadata', 'add', nil, { id: "add_metadata_"+ subtype['type'], class:"add_metadata"} ) %>
            <% if subtype["metadata"] %>
              <%= button_link_to('Download metadata', 'download', {:action => :get_metadata,
                :project_id => params[:project_id],:dataset_id => params[:dataset_id],:subtype_name => subtype['type']},
                method: :get) %>
            <% end %>
            <%= submit_tag('Register', class: 'btn btn-primary btn-xs pull-right') %>
        <% end %>
      </li>
  <% end %>
</ul>

<%= modal(id: 'upload-file', size: 'm', class: 'text-left') do %>
  <%= form_tag({:action => :add_metadata}, :multipart => true) do %>
    <%= modal_header('Add metadata') %>
    <%= modal_body do %>
      <%= render :partial=>"assets/upload_box",:locals=>{:resource=>@data_file} -%>
    <% end %>
    <%= modal_footer do %>
      <%= create_button id:"data_file_submit_btn",
                          onclick:"return validateResourceFields('data_file');",
                          class:'btn btn-primary' %>
      <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>

    <% end %>
  <% end %>
<% end %>

<script>
  $j(document).ready(function () {
    $j('.add_metadata').on('click', function () {
      // alert("adding metadata");
      $j('#upload-file').modal('show');
      // var form = $j('#upload-file form');
      // // var collectionId = $j(this).data('collectionId');
      // // form.attr('action', form.attr('action').replace('-collection-id-', collectionId));

      return false;
    });
  });
</script>
