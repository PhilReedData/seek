<div id="resource_titles">
  <div class="alert alert-info">
    <p>
      The title must be provided in English. For example for studies, the full name of the study would be appropriate.
      If no title is in use yet, please define a title that is suitable for public display.
      If the original title of the resource is non-English, please provide both titles: an original title and its English translation.
    </p>
    <p>
      You need to enter at least one title before you can <b>save</b> it.
      <b>The first title and description will be by default the main title and description</b> of the resource.
      You will be able to edit the resource once it has been created.
    </p>
  </div>
    <table class="table" id="resource-title-table">
      <thead>
      <tr>
        <th width="19em"><label class="save-required">Title language</label></th>
        <th><label class="save-required">Title</label></th>
        <th width="19em"></th>
      </tr>
      </thead>
      <tbody>
      <% if @studyhub_resource.resource_json.nil? %>
        <%= render :partial => 'title_row', :locals=> {:studyhub_resource=>@studyhub_resource,:f => f, :index => 0} %>
      <% else %>
        <% @studyhub_resource.resource_json['resource_titles'].each_with_index do |title, index| %>
          <%= render :partial => 'title_row', :locals=> {:studyhub_resource=>@studyhub_resource,:f => f, :index => index} %>
        <% end %>
      <% end %>
      <tr id="title-row">
          <td colspan="6">
            <%= button_link_to('Add more titles', 'add', '#', :id => 'add-title-row') %>
          </td>
        </tr>
      </tbody>
    </table>



    <table id="new-title-row" style="display: none">
      <tbody>
      <%= render :partial => 'title_row', :locals=> {:studyhub_resource=>@studyhub_resource,:f => f } %>
      </tbody>
    </table>

  </div>



<script>
    //used to hold the element Id that needs updating after csreating a new CV
    $j(document).ready(function () {
        $j('#add-title-row').click(function () {
            var newRow = $j('#new-title-row tbody').clone().html();
            var index = 0;
            $j('#resource-title-table tr.resource-title').each(function () {
                var newIndex = parseInt($j(this).data('index'));
                if (newIndex > index) {
                    index = newIndex;
                }
            });

            index++;

            newRow = newRow.replace(/row-template/g, index);

            $j('#resource-title-table #title-row').before($j(newRow));
            $j('select[name="studyhub_resource[resource_language]['+index+']"]').val("EN");
            $j('input[name="studyhub_resource[resource_title]['+index+']"]').val("");



            return false;
        });

        $j('#resource-title-table').on('change', '.destroy-row', SR.removetitleRow);

    });
</script>

