<% resource = @studyhub_resource.resource_json.nil? ? @studyhub_resource : @studyhub_resource.resource_json["study_design"] %>

<div id="studyhub_resource_study_design">
<%= folding_panel("Study Design:", folded) do %>

  <%
    cmt = CustomMetadataType.where(title:"NFDI4Health Studyhub Resource StudyDesign",supported_type:@studyhub_resource.class.name).first
  %>
  <%= render partial: 'studyhub_resources/studyhub_custom_metadata_fields', locals: { custom_metadata_type: cmt, resource: resource } %>
<% end %>
</div>


<script>
    $j(document).ready(function () {

        SR.intialStudyPrimaryDesignVisibility();
        SR.intialStudyDataSharingPlanVisibility();

        $j('#studyhub_resource_study_design').on('change', 'select[name="studyhub_resource[custom_metadata_attributes][data][study_primary_design]"]', SR.setStudyPrimaryDesignVisibility);
        $j('#studyhub_resource_study_design').on('change', 'select[name="studyhub_resource[custom_metadata_attributes][data][study_data_sharing_plan_generally]"]', SR.setStudyDataSharingPlanVisibility);

    });
</script>